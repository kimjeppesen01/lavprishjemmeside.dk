<!DOCTYPE html><html lang="da"> <head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="icon" href="/favicon.ico"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="noindex, nofollow"><title>Header &amp; Footer ‚Äî Admin</title><link rel="stylesheet" href="/_astro/ai-assemble.CrJsF0lM.css"></head> <body class="min-h-screen bg-gray-50 text-gray-900 antialiased"> <!-- Auth guard: redirect if no token (runs before anything renders) --> <script>
    (function() {
      var token = localStorage.getItem('admin_token');
      var path = window.location.pathname.replace(/\/$/, '') || '/admin';
      var isLoginPage = path === '/admin';
      if (!token && !isLoginPage) {
        window.location.href = '/admin/';
        return;
      }
      if (token && isLoginPage) {
        window.location.href = '/admin/dashboard/';
        return;
      }
    })();
    </script> <div class="flex min-h-screen"> <!-- Sidebar --> <aside id="admin-sidebar" class="hidden w-64 bg-gray-900 text-gray-100 min-h-screen flex-col"> <div class="p-4 border-b border-gray-700"> <a href="/admin/dashboard/" class="text-lg font-bold text-white">LPH Admin</a> </div> <nav class="flex-1 p-4 space-y-1"> <a href="/admin/dashboard/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Oversigt
</a> <div class="pt-2 mt-2 border-t border-gray-700"> <p class="px-3 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider">Webstedskonfig</p> <a href="/admin/pages/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Sider
</a> <a href="/admin/styling/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Design &amp; styling
</a> <a href="/admin/header-footer/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Header &amp; Footer
</a> <a href="/admin/components/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Komponenter
</a> <a href="/admin/ai-assemble/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
AI-assembler
</a> </div> </nav> <div class="p-4 border-t border-gray-700"> <button id="logout-btn" class="w-full text-left text-sm text-gray-400 hover:text-white">
Log ud
</button> </div> </aside> <!-- Main content --> <div class="flex-1 flex flex-col"> <!-- Top bar --> <header id="admin-header" class="hidden bg-white border-b border-gray-200 px-6 py-3 items-center justify-between"> <button id="mobile-menu-btn" class="lg:hidden text-gray-600 text-sm">
&#9776; Menu
</button> <div class="flex-1"></div> <span id="admin-email" class="text-sm text-gray-500"></span> </header> <!-- Page content --> <main class="flex-1 p-6">  <div class="max-w-6xl mx-auto"> <div class="mb-8"> <h1 class="text-3xl font-bold text-gray-900">Header & Footer</h1> <p class="text-gray-600 mt-2">Konfigurer navigation og footer til hele sitet</p> </div> <div id="loading" class="text-center py-12 text-gray-500">Henter indstillinger...</div> <div id="error" class="hidden bg-red-50 border border-red-200 rounded-xl p-4 mb-6"> <p class="text-red-700" id="error-text"></p> <button onclick="window.location.reload()" class="mt-2 text-red-600 underline text-sm">Pr√∏v igen</button> </div> <div id="content" class="hidden space-y-8"> <form id="hf-form" class="space-y-8"> <!-- Layout selector --> <section class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"> <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50"> <h2 class="text-lg font-semibold text-gray-900">Header-layout</h2> <p class="text-sm text-gray-600 mt-1">V√¶lg hvordan headeren vises p√• dit websted</p> </div> <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"> <label class="relative cursor-pointer group"> <input type="radio" name="header_layout" value="regular" class="peer sr-only"> <div class="rounded-xl border-2 border-gray-200 p-5 transition-all peer-checked:border-blue-600 peer-checked:ring-2 peer-checked:ring-blue-600/20 hover:border-gray-300"> <div class="flex items-center gap-2 mb-3"> <span class="w-3 h-3 rounded-full bg-gray-400"></span> <span class="w-16 h-2 bg-gray-200 rounded"></span> <span class="flex-1 h-2 bg-gray-100 rounded"></span> <span class="w-20 h-2 bg-gray-300 rounded"></span> </div> <p class="font-medium text-gray-900">Regular</p> <p class="text-sm text-gray-500 mt-1">Logo venstre ¬∑ Menu center ¬∑ Menu h√∏jre</p> </div> </label> <label class="relative cursor-pointer group"> <input type="radio" name="header_layout" value="modern" class="peer sr-only"> <div class="rounded-xl border-2 border-gray-200 p-5 transition-all peer-checked:border-blue-600 peer-checked:ring-2 peer-checked:ring-blue-600/20 hover:border-gray-300"> <div class="flex flex-col items-center gap-2 mb-3"> <span class="w-8 h-8 rounded bg-gray-300"></span> <span class="w-full h-2 bg-gray-200 rounded"></span> </div> <p class="font-medium text-gray-900">Modern</p> <p class="text-sm text-gray-500 mt-1">Logo over menu, centreret</p> </div> </label> <label class="relative cursor-pointer group"> <input type="radio" name="header_layout" value="mega" class="peer sr-only"> <div class="rounded-xl border-2 border-gray-200 p-5 transition-all peer-checked:border-blue-600 peer-checked:ring-2 peer-checked:ring-blue-600/20 hover:border-gray-300"> <div class="flex gap-1 mb-3"> <span class="flex-1 h-2 bg-gray-300 rounded"></span> <span class="flex-1 h-2 bg-gray-200 rounded"></span> <span class="flex-1 h-2 bg-gray-200 rounded"></span> <span class="flex-1 h-2 bg-gray-200 rounded"></span> </div> <div class="grid grid-cols-3 gap-1 h-12 bg-gray-50 rounded"></div> <p class="font-medium text-gray-900">Mega</p> <p class="text-sm text-gray-500 mt-1">Brugertilpasset HTML-struktur</p> </div> </label> <label class="relative cursor-pointer group"> <input type="radio" name="header_layout" value="modern-mega" class="peer sr-only"> <div class="rounded-xl border-2 border-gray-200 p-5 transition-all peer-checked:border-blue-600 peer-checked:ring-2 peer-checked:ring-blue-600/20 hover:border-gray-300"> <div class="flex gap-1 mb-3"> <span class="flex-1 h-2 bg-blue-400 rounded"></span> <span class="flex-1 h-2 bg-blue-200 rounded"></span> <span class="flex-1 h-2 bg-blue-200 rounded"></span> </div> <div class="grid grid-cols-2 gap-1 h-10 bg-blue-50 rounded"></div> <p class="font-medium text-gray-900">Modern Mega</p> <p class="text-sm text-gray-500 mt-1">Stripe-style morphing dropdown</p> </div> </label> </div> </section> <!-- Logo (all layouts) --> <section class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"> <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50"> <h2 class="text-lg font-semibold text-gray-900">Logo</h2> </div> <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4"> <div> <label class="block text-sm font-medium text-gray-700 mb-1">Logo URL</label> <input type="text" id="header_logo_url" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" placeholder="/favicon.svg"> </div> <div> <label class="block text-sm font-medium text-gray-700 mb-1">Fallback-tekst</label> <input type="text" id="header_logo_text" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" placeholder="lavprishjemmeside.dk" maxlength="100"> </div> </div> </section> <!-- Menus (Regular + Modern) --> <div id="menus-section"> <section class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"> <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50"> <h2 class="text-lg font-semibold text-gray-900">Menu 1</h2> <p class="text-sm text-gray-500 mt-1">Hovednavigation (center i Regular, under logo i Modern)</p> </div> <div class="p-6"> <div id="menu1-items" class="space-y-2"></div> <button type="button" id="add-menu1" class="mt-3 text-sm text-blue-600 hover:text-blue-700 font-medium">+ Tilf√∏j link</button> </div> </section> <section id="menu2-section" class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"> <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50"> <h2 class="text-lg font-semibold text-gray-900">Menu 2</h2> <p class="text-sm text-gray-500 mt-1">Knap-links h√∏jre (kun Regular)</p> </div> <div class="p-6"> <div id="menu2-items" class="space-y-2"></div> <button type="button" id="add-menu2" class="mt-3 text-sm text-blue-600 hover:text-blue-700 font-medium">+ Tilf√∏j link</button> </div> </section> </div> <!-- Modern Mega Menu (structured) --> <section id="modern-mega-section" class="hidden bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"> <div class="px-6 py-4 border-b border-gray-100 bg-blue-50/50"> <h2 class="text-lg font-semibold text-gray-900">Modern Mega Menu</h2> <p class="text-sm text-gray-600 mt-1">Stripe-style morphing dropdown. Tilf√∏j kategorier med underafdelinger og links.</p> </div> <div class="p-6"> <div id="mega-menu-categories" class="space-y-6"></div> <button type="button" id="add-mega-category" class="mt-4 text-sm text-blue-600 hover:text-blue-700 font-medium">+ Tilf√∏j kategori</button> </div> </section> <!-- Mega HTML --> <section id="mega-section" class="hidden bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"> <div class="px-6 py-4 border-b border-gray-100 bg-amber-50/50"> <h2 class="text-lg font-semibold text-gray-900">Mega menu HTML</h2> <p class="text-sm text-gray-600 mt-1">Kopier vores skabelon, tilpas den, og inds√¶t herunder.</p> <button type="button" id="copy-mega-template" class="mt-3 inline-flex items-center gap-2 px-3 py-1.5 bg-amber-100 hover:bg-amber-200 rounded-lg text-sm font-medium text-amber-900">
üìã Kopier skabelon
</button> </div> <div class="p-6"> <textarea id="header_mega_html" rows="14" class="w-full font-mono text-sm border border-gray-300 rounded-lg p-4" placeholder="Inds√¶t din tilpassede mega menu HTML her..."></textarea> </div> </section> <!-- Footer --> <section class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden"> <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50"> <h2 class="text-lg font-semibold text-gray-900">Footer</h2> <p class="text-sm text-gray-500 mt-1">Kolonneindhold og copyright</p> </div> <div class="p-6 space-y-6"> <div id="footer-columns"></div> <button type="button" id="add-footer-column" class="text-sm text-blue-600 hover:text-blue-700 font-medium">+ Tilf√∏j kolonne</button> <div> <label class="block text-sm font-medium text-gray-700 mb-1">Copyright-tekst</label> <input type="text" id="footer_copyright" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" placeholder="¬© 2025 Dit firma. Alle rettigheder forbeholdes."> </div> </div> </section> <div class="flex gap-4"> <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl transition-colors">
Gem indstillinger
</button> <a href="/admin/dashboard/" class="px-6 py-3 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 font-medium">
Annuller
</a> </div> <!-- Publish to live --> <section class="mt-8 p-6 rounded-2xl border-2 border-amber-200 bg-amber-50/50"> <h3 class="font-semibold text-gray-900 mb-1">Publicer til live</h3> <p class="text-sm text-gray-600 mb-4">√Ündringer er gemt i databasen, men kr√¶ver en genbuild for at vises p√• sitet. Klik for at starte udrulning.</p> <button type="button" id="publish-btn" class="px-6 py-3 bg-amber-600 hover:bg-amber-700 text-white font-medium rounded-xl transition-colors">
Publicer til live nu (~90 sek)
</button> </section> </form> </div> <div id="success-toast" class="fixed bottom-6 right-6 bg-green-600 text-white px-4 py-3 rounded-xl shadow-lg hidden z-50">
‚úì Indstillinger gemt
</div> </div> <script>
  (function() {
    const API = 'https://api.lavprishjemmeside.dk';
    const token = localStorage.getItem('admin_token');
    if (!token) { window.location.href = '/admin/'; return; }

    const MEGA_TEMPLATE = `<!-- Mega menu skabelon ‚Äî tilpas til dit behov -->
<nav class="mega-nav flex items-center justify-between py-4 px-4 max-w-6xl mx-auto">
  <a href="/" class="text-xl font-bold text-[var(--color-primary)]">Dit firma</a>
  <ul class="hidden md:flex gap-6">
    <li class="group relative">
      <a href="/ydelser" class="text-gray-700 hover:text-[var(--color-primary)]">Ydelser</a>
      <div class="absolute left-0 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
        <div class="bg-white rounded-lg shadow-lg border border-gray-200 p-6 w-80">
          <h4 class="font-semibold text-gray-900 mb-3">Vores ydelser</h4>
          <ul class="space-y-2">
            <li><a href="/ydelser/webbureau" class="text-gray-600 hover:text-[var(--color-primary)]">Webbureau</a></li>
            <li><a href="/ydelser/seo" class="text-gray-600 hover:text-[var(--color-primary)]">SEO</a></li>
            <li><a href="/ydelser/hosting" class="text-gray-600 hover:text-[var(--color-primary)]">Hosting</a></li>
          </ul>
        </div>
      </div>
    </li>
    <li><a href="/om-os" class="text-gray-700 hover:text-[var(--color-primary)]">Om os</a></li>
    <li><a href="/kontakt" class="text-gray-700 hover:text-[var(--color-primary)]">Kontakt</a></li>
  </ul>
  <a href="/kontakt" class="hidden md:inline-block bg-[var(--color-primary)] text-white px-4 py-2 rounded-lg">Kontakt</a>
</nav>`;

    let data = {};

    function esc(s) {
      const d = document.createElement('div');
      d.textContent = s || '';
      return d.innerHTML;
    }

    function menuItemHtml(idx, href, label) {
      return '<div class="flex gap-2 items-center" data-idx="' + idx + '">' +
        '<input type="text" placeholder="URL" value="' + esc(href) + '" class="menu-href flex-1 border border-gray-300 rounded px-2 py-1.5 text-sm">' +
        '<input type="text" placeholder="Tekst" value="' + esc(label) + '" class="menu-label flex-1 border border-gray-300 rounded px-2 py-1.5 text-sm">' +
        '<button type="button" class="menu-remove text-red-500 hover:text-red-700 p-1">√ó</button>' +
      '</div>';
    }

    function renderMenu(containerId, items, addBtnId) {
      const el = document.getElementById(containerId);
      if (!el) return;
      el.innerHTML = items.map((it, i) => menuItemHtml(i, it.href, it.label)).join('');
      el.querySelectorAll('.menu-remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const idx = parseInt(btn.closest('[data-idx]').getAttribute('data-idx'), 10);
          items.splice(idx, 1);
          renderMenu(containerId, items, addBtnId);
        });
      });
      document.getElementById(addBtnId)?.replaceWith(document.getElementById(addBtnId)?.cloneNode(true));
      document.getElementById(addBtnId)?.addEventListener('click', () => {
        items.push({ href: '/', label: 'Nyt link' });
        renderMenu(containerId, items, addBtnId);
      });
    }

    function footerColumnHtml(colIdx, col) {
      const hasText = col.text != null && col.text !== '';
      const hasLinks = col.links && col.links.length > 0;
      let html = '<div class="border border-gray-200 rounded-lg p-4" data-col-idx="' + colIdx + '">' +
        '<div class="flex justify-between mb-3"><input type="text" placeholder="Kolonne titel" value="' + esc(col.title) + '" class="footer-col-title border border-gray-300 rounded px-2 py-1.5 text-sm flex-1 mr-2">' +
        '<button type="button" class="footer-col-remove text-red-500 hover:text-red-700 text-sm">Fjern</button></div>';
      html += '<textarea placeholder="Beskrivelse (lad st√• tom hvis du bruger links)" class="footer-col-text w-full border border-gray-300 rounded px-2 py-1.5 text-sm mb-2" rows="2">' + esc(col.text) + '</textarea>';
      html += '<div class="footer-col-links space-y-1">';
      (col.links || []).forEach((link, i) => {
        html += '<div class="flex gap-2" data-link-idx="' + i + '"><input type="text" placeholder="URL" value="' + esc(link.href) + '" class="link-href flex-1 border rounded px-2 py-1 text-sm">' +
          '<input type="text" placeholder="Tekst" value="' + esc(link.label) + '" class="link-label flex-1 border rounded px-2 py-1 text-sm">' +
          '<button type="button" class="link-remove text-red-500">√ó</button></div>';
      });
      html += '</div><button type="button" class="footer-add-link mt-1 text-xs text-blue-600">+ Link</button></div>';
      return html;
    }

    function renderMegaMenuCategories() {
      const container = document.getElementById('mega-menu-categories');
      if (!container) return;
      const defaultItems = [
        { id: 'ydelser', title: 'Ydelser', sections: [{ heading: 'Tjenester', links: [{ href: '/ydelser', label: 'Ydelser' }, { href: '/priser', label: 'Priser' }] }] },
        { id: 'sider', title: 'Sider', sections: [{ heading: 'Sider', links: [{ href: '/', label: 'Forside' }, { href: '/om-os', label: 'Om os' }, { href: '/kontakt', label: 'Kontakt' }] }] },
      ];
      if (!data.header_mega_menu || !Array.isArray(data.header_mega_menu) || !data.header_mega_menu.length) {
        data.header_mega_menu = JSON.parse(JSON.stringify(defaultItems));
      }
      const items = data.header_mega_menu;
      container.innerHTML = items.map((cat, ci) => {
        let html = '<div class="border border-gray-200 rounded-xl p-4" data-mega-category data-cat-idx="' + ci + '">';
        html += '<div class="flex justify-between items-center mb-3">';
        html += '<input type="text" placeholder="Kategori-titel (f.eks. Ydelser)" value="' + esc(cat.title) + '" class="mega-cat-title border border-gray-300 rounded px-2 py-1.5 text-sm font-medium flex-1 mr-2">';
        html += '<input type="text" placeholder="ID (slug)" value="' + esc(cat.id) + '" class="mega-cat-id border border-gray-300 rounded px-2 py-1.5 text-xs w-24">';
        html += '<button type="button" class="mega-cat-remove text-red-500 hover:text-red-700 ml-2">√ó</button></div>';
        html += '<div class="mega-sections space-y-3">';
        (cat.sections || []).forEach((sec, si) => {
          html += '<div class="border-l-2 border-gray-200 pl-3" data-mega-section data-sec-idx="' + si + '">';
          html += '<input type="text" placeholder="Sektionsoverskrift" value="' + esc(sec.heading) + '" class="mega-sec-heading border border-gray-300 rounded px-2 py-1 text-sm w-full mb-2">';
          html += '<div class="mega-links space-y-1">';
          (sec.links || []).forEach((link, li) => {
            html += '<div class="flex gap-2" data-mega-link data-link-idx="' + li + '">';
            html += '<input type="text" placeholder="URL" value="' + esc(link.href) + '" class="mega-link-href flex-1 border rounded px-2 py-1 text-xs">';
            html += '<input type="text" placeholder="Tekst" value="' + esc(link.label) + '" class="mega-link-label flex-1 border rounded px-2 py-1 text-xs">';
            html += '<button type="button" class="mega-link-remove text-red-500 text-xs">√ó</button></div>';
          });
          html += '</div><button type="button" class="mega-sec-add-link mt-1 text-xs text-blue-600">+ Link</button>';
          html += '</div>';
        });
        html += '</div><button type="button" class="mega-sec-add mt-2 text-xs text-blue-600">+ Sektion</button></div>';
        return html;
      }).join('');

      container.querySelectorAll('.mega-cat-remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const idx = parseInt(btn.closest('[data-mega-category]').getAttribute('data-cat-idx'), 10);
          data.header_mega_menu = data.header_mega_menu || [];
          data.header_mega_menu.splice(idx, 1);
          renderMegaMenuCategories();
        });
      });
      container.querySelectorAll('.mega-link-remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const secEl = btn.closest('[data-mega-section]');
          const catEl = btn.closest('[data-mega-category]');
          const catIdx = parseInt(catEl.getAttribute('data-cat-idx'), 10);
          const secIdx = parseInt(secEl.getAttribute('data-sec-idx'), 10);
          const linkIdx = parseInt(btn.closest('[data-mega-link]').getAttribute('data-link-idx'), 10);
          data.header_mega_menu[catIdx].sections[secIdx].links.splice(linkIdx, 1);
          renderMegaMenuCategories();
        });
      });
      container.querySelectorAll('.mega-sec-add-link').forEach(btn => {
        btn.addEventListener('click', function() {
          const secEl = btn.closest('[data-mega-section]');
          const catEl = btn.closest('[data-mega-category]');
          const catIdx = parseInt(catEl.getAttribute('data-cat-idx'), 10);
          const secIdx = parseInt(secEl.getAttribute('data-sec-idx'), 10);
          if (!data.header_mega_menu[catIdx].sections[secIdx].links) data.header_mega_menu[catIdx].sections[secIdx].links = [];
          data.header_mega_menu[catIdx].sections[secIdx].links.push({ href: '/', label: 'Nyt link' });
          renderMegaMenuCategories();
        });
      });
      container.querySelectorAll('.mega-sec-add').forEach(btn => {
        btn.addEventListener('click', function() {
          const catIdx = parseInt(btn.closest('[data-mega-category]').getAttribute('data-cat-idx'), 10);
          if (!data.header_mega_menu[catIdx].sections) data.header_mega_menu[catIdx].sections = [];
          data.header_mega_menu[catIdx].sections.push({ heading: 'Ny sektion', links: [{ href: '/', label: 'Link' }] });
          renderMegaMenuCategories();
        });
      });
      document.getElementById('add-mega-category')?.replaceWith(document.getElementById('add-mega-category')?.cloneNode(true));
      document.getElementById('add-mega-category')?.addEventListener('click', () => {
        data.header_mega_menu = data.header_mega_menu || [];
        data.header_mega_menu.push({ id: 'kategori-' + data.header_mega_menu.length, title: 'Ny kategori', sections: [{ heading: 'Sektion', links: [{ href: '/', label: 'Link' }] }] });
        renderMegaMenuCategories();
      });
    }

    function renderFooterColumns() {
      const container = document.getElementById('footer-columns');
      if (!container) return;
      container.innerHTML = (data.footer_columns || []).map((col, i) => footerColumnHtml(i, col)).join('');

      container.querySelectorAll('.footer-col-remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const idx = parseInt(btn.closest('[data-col-idx]').getAttribute('data-col-idx'), 10);
          data.footer_columns.splice(idx, 1);
          renderFooterColumns();
        });
      });
      container.querySelectorAll('.footer-add-link').forEach(btn => {
        btn.addEventListener('click', function() {
          const colEl = btn.closest('[data-col-idx]');
          const idx = parseInt(colEl.getAttribute('data-col-idx'), 10);
          if (!data.footer_columns[idx].links) data.footer_columns[idx].links = [];
          data.footer_columns[idx].links.push({ href: '/', label: 'Nyt link' });
          renderFooterColumns();
        });
      });
      container.querySelectorAll('.link-remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const colEl = btn.closest('[data-col-idx]');
          const linkEl = btn.closest('[data-link-idx]');
          const colIdx = parseInt(colEl.getAttribute('data-col-idx'), 10);
          const linkIdx = parseInt(linkEl.getAttribute('data-link-idx'), 10);
          data.footer_columns[colIdx].links.splice(linkIdx, 1);
          renderFooterColumns();
        });
      });

      document.getElementById('add-footer-column').replaceWith(document.getElementById('add-footer-column').cloneNode(true));
      document.getElementById('add-footer-column').addEventListener('click', () => {
        data.footer_columns.push({ title: 'Ny kolonne', links: [{ href: '/', label: 'Link' }] });
        renderFooterColumns();
      });
    }

    function collectFormData() {
      const layout = document.querySelector('input[name="header_layout"]:checked')?.value || 'regular';
      const menu1 = [];
      document.querySelectorAll('#menu1-items [data-idx]').forEach(row => {
        const h = row.querySelector('.menu-href')?.value?.trim();
        const l = row.querySelector('.menu-label')?.value?.trim();
        if (h && l) menu1.push({ href: h, label: l });
      });
      const menu2 = [];
      document.querySelectorAll('#menu2-items [data-idx]').forEach(row => {
        const h = row.querySelector('.menu-href')?.value?.trim();
        const l = row.querySelector('.menu-label')?.value?.trim();
        if (h && l) menu2.push({ href: h, label: l });
      });
      const footerColumns = [];
      document.querySelectorAll('#footer-columns [data-col-idx]').forEach(colEl => {
        const title = colEl.querySelector('.footer-col-title')?.value?.trim() || 'Kolonnetitel';
        const text = colEl.querySelector('.footer-col-text')?.value?.trim();
        const links = [];
        colEl.querySelectorAll('[data-link-idx]').forEach(linkEl => {
          const href = linkEl.querySelector('.link-href')?.value?.trim();
          const label = linkEl.querySelector('.link-label')?.value?.trim();
          if (href && label) links.push({ href, label });
        });
        if (text) footerColumns.push({ title, text });
        else if (links.length) footerColumns.push({ title, links });
        else footerColumns.push({ title, links: [{ href: '/', label: 'Link' }] });
      });

      const megaMenu = collectMegaMenu();
      return {
        header_layout: layout,
        header_logo_url: document.getElementById('header_logo_url')?.value?.trim() || '/favicon.svg',
        header_logo_text: document.getElementById('header_logo_text')?.value?.trim() || 'Sitetitel',
        header_menu_1: menu1.length ? menu1 : [{ href: '/', label: 'Forside' }],
        header_menu_2: menu2.length ? menu2 : [],
        header_mega_html: document.getElementById('header_mega_html')?.value?.trim() || null,
        header_mega_menu: (layout === 'modern-mega' && megaMenu.length) ? megaMenu : null,
        footer_columns: footerColumns.length ? footerColumns : data.footer_columns || [],
        footer_copyright: document.getElementById('footer_copyright')?.value?.trim() || null,
      };
    }

    function collectMegaMenu() {
      const out = [];
      document.querySelectorAll('[data-mega-category]').forEach(catEl => {
        const title = catEl.querySelector('.mega-cat-title')?.value?.trim();
        const id = (catEl.querySelector('.mega-cat-id')?.value?.trim() || (title || '').toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '')) || 'cat-' + out.length;
        if (!title) return;
        const sections = [];
        catEl.querySelectorAll('[data-mega-section]').forEach(secEl => {
          const heading = secEl.querySelector('.mega-sec-heading')?.value?.trim();
          if (!heading) return;
          const links = [];
          secEl.querySelectorAll('[data-mega-link]').forEach(linkEl => {
            const href = linkEl.querySelector('.mega-link-href')?.value?.trim();
            const label = linkEl.querySelector('.mega-link-label')?.value?.trim();
            if (href && label) links.push({ href, label });
          });
          sections.push({ heading, links: links.length ? links : [{ href: '/', label: 'Link' }] });
        });
        if (sections.length) out.push({ id, title, sections });
        else out.push({ id, title, sections: [{ heading: 'Sektion', links: [{ href: '/', label: 'Link' }] }] });
      });
      return out;
    }

    function toggleLayoutSections(layout) {
      const menus = document.getElementById('menus-section');
      const menu2 = document.getElementById('menu2-section');
      const mega = document.getElementById('mega-section');
      const modernMega = document.getElementById('modern-mega-section');
      if (menus) menus.classList.toggle('hidden', layout === 'mega' || layout === 'modern-mega');
      if (menu2) menu2.classList.toggle('hidden', layout === 'modern');
      if (mega) mega.classList.toggle('hidden', layout !== 'mega');
      if (modernMega) modernMega.classList.toggle('hidden', layout !== 'modern-mega');
    }

    async function load() {
      try {
        const res = await fetch(API + '/header-footer/', { headers: { 'Authorization': 'Bearer ' + token } });
        if (!res.ok) throw new Error('Kunne ikke hente');
        data = await res.json();
      } catch (e) {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').classList.remove('hidden');
        document.getElementById('error-text').textContent = e.message;
        return;
      }

      document.querySelector('input[name="header_layout"][value="' + (data.header_layout || 'regular') + '"]')?.click();
      document.getElementById('header_logo_url').value = data.header_logo_url || '/favicon.svg';
      document.getElementById('header_logo_text').value = data.header_logo_text || 'lavprishjemmeside.dk';
      document.getElementById('header_mega_html').value = data.header_mega_html || '';
      document.getElementById('footer_copyright').value = data.footer_copyright || '';

      renderMenu('menu1-items', Array.isArray(data.header_menu_1) ? [...data.header_menu_1] : [{ href: '/', label: 'Forside' }], 'add-menu1');
      renderMenu('menu2-items', Array.isArray(data.header_menu_2) ? [...data.header_menu_2] : [], 'add-menu2');
      if (!data.header_mega_menu || !Array.isArray(data.header_mega_menu)) data.header_mega_menu = [];
      renderMegaMenuCategories();
      if (!data.footer_columns || !data.footer_columns.length) {
        data.footer_columns = [{ title: 'Kolonnetitel', text: 'Beskrivelse' }, { title: 'Links', links: [{ href: '/', label: 'Forside' }] }];
      }
      renderFooterColumns();
      toggleLayoutSections(data.header_layout || 'regular');

      document.querySelectorAll('input[name="header_layout"]').forEach(radio => {
        radio.addEventListener('change', () => toggleLayoutSections(radio.value));
      });

      document.getElementById('loading').classList.add('hidden');
      document.getElementById('content').classList.remove('hidden');
    }

    document.getElementById('copy-mega-template').addEventListener('click', () => {
      navigator.clipboard.writeText(MEGA_TEMPLATE).then(() => {
        const btn = document.getElementById('copy-mega-template');
        btn.textContent = '‚úì Kopieret!';
        setTimeout(() => { btn.textContent = 'üìã Kopier skabelon'; }, 2000);
      });
    });

    document.getElementById('hf-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = e.target.querySelector('button[type="submit"]');
      if (btn) { btn.disabled = true; btn.textContent = 'Gemmer...'; }
      try {
        const payload = collectFormData();
        const res = await fetch(API + '/header-footer/update', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        if (!res.ok) throw new Error((await res.json()).error || 'Fejl');
        document.getElementById('success-toast').classList.remove('hidden');
        document.getElementById('success-toast').textContent = '‚úì Indstillinger gemt. Klik "Publicer til live" for at vise p√• sitet.';
        setTimeout(() => {
          document.getElementById('success-toast').classList.add('hidden');
          document.getElementById('success-toast').textContent = '‚úì Indstillinger gemt';
        }, 5000);
      } catch (err) {
        alert('Fejl: ' + err.message);
      } finally {
        if (btn) { btn.disabled = false; btn.textContent = 'Gem indstillinger'; }
      }
    });

    document.getElementById('publish-btn').addEventListener('click', async function() {
      const btn = this;
      btn.disabled = true;
      btn.textContent = 'Starter...';
      try {
        const res = await fetch(API + '/publish', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' }
        });
        const data = await res.json();
        if (res.ok) {
          btn.textContent = '‚úì Udrulning startet';
          btn.classList.remove('bg-amber-600', 'hover:bg-amber-700');
          btn.classList.add('bg-green-600');
        } else {
          throw new Error(data.error || res.status);
        }
      } catch (err) {
        alert('Fejl: ' + err.message);
        btn.textContent = 'Publicer til live nu (~90 sek)';
      } finally {
        btn.disabled = false;
      }
    });

    load();
  })();
  </script>  </main> </div> </div> <!-- Sidebar/header visibility + logout --> <script>
    (function() {
      var path = window.location.pathname.replace(/\/$/, '') || '/admin';
      if (path === '/admin') return;

      // Show sidebar and header on dashboard pages
      var sidebar = document.getElementById('admin-sidebar');
      var header = document.getElementById('admin-header');
      if (sidebar) { sidebar.classList.remove('hidden'); sidebar.classList.add('lg:flex'); }
      if (header) { header.classList.remove('hidden'); header.classList.add('flex'); }

      // Show admin email from JWT
      try {
        var token = localStorage.getItem('admin_token');
        if (token) {
          var payload = JSON.parse(atob(token.split('.')[1]));
          var emailEl = document.getElementById('admin-email');
          if (emailEl) emailEl.textContent = payload.email || '';
        }
      } catch(e) {}

      // Logout
      var logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          localStorage.removeItem('admin_token');
          window.location.href = '/admin/';
        });
      }

      // Mobile menu toggle
      var menuBtn = document.getElementById('mobile-menu-btn');
      if (menuBtn && sidebar) {
        menuBtn.addEventListener('click', function() {
          sidebar.classList.toggle('hidden');
          sidebar.classList.toggle('fixed');
          sidebar.classList.toggle('z-50');
          sidebar.classList.toggle('inset-0');
          sidebar.classList.toggle('flex');
        });
      }

      // Highlight active nav item
      var normalizedPath = path.replace(/\/$/, '') || '/admin';
      var links = sidebar ? sidebar.querySelectorAll('nav a[href]') : [];
      links.forEach(function(a) {
        var href = a.getAttribute('href') || '';
        var linkPath = href.replace(/\/$/, '') || '/admin';
        if (normalizedPath === linkPath) {
          a.classList.add('bg-gray-800', 'text-white');
          a.classList.remove('hover:bg-gray-800');
        }
      });
    })();
    </script>  </body></html>
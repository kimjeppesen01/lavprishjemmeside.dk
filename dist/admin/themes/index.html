<!DOCTYPE html><html lang="da"> <head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="icon" href="/favicon.ico"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="noindex, nofollow"><title>Temaer ‚Äî Admin</title><link rel="stylesheet" href="/_astro/ai-assemble.CMAfSiqN.css"></head> <body class="min-h-screen bg-gray-50 text-gray-900 antialiased"> <!-- Auth guard: redirect if no token (runs before anything renders) --> <script>
    (function() {
      var token = localStorage.getItem('admin_token');
      var path = window.location.pathname.replace(/\/$/, '') || '/admin';
      var isLoginPage = path === '/admin';
      if (!token && !isLoginPage) {
        window.location.href = '/admin/';
        return;
      }
      if (token && isLoginPage) {
        window.location.href = '/admin/dashboard/';
        return;
      }
    })();
    </script> <div class="flex min-h-screen"> <!-- Sidebar --> <aside id="admin-sidebar" class="hidden w-64 bg-gray-900 text-gray-100 min-h-screen flex-col"> <div class="p-4 border-b border-gray-700"> <a href="/admin/dashboard/" class="text-lg font-bold text-white">LPH Admin</a> </div> <nav class="flex-1 p-4 space-y-1"> <a href="/admin/master/" id="master-hub-link" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm font-medium">
Master Hub
</a> <div class="border-t border-gray-700 my-1"></div> <a href="/admin/dashboard/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Oversigt
</a> <a href="/admin/traffic/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
üìà Trafik
</a> <div class="pt-2 mt-2 border-t border-gray-700"> <p class="px-3 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider">Webstedskonfig</p> <a href="/admin/pages/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Sider
</a> <a href="/admin/styling/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Design &amp; styling
</a> <a href="/admin/themes/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Temaer
</a> <a href="/admin/header-footer/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Header &amp; Footer
</a> <a href="/admin/components/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
Komponenter
</a> <a href="/admin/ai-assemble/" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 text-sm">
AI-assembler
</a> </div> </nav> <div class="p-4 border-t border-gray-700"> <button id="logout-btn" class="w-full text-left text-sm text-gray-400 hover:text-white">
Log ud
</button> </div> </aside> <!-- Main content --> <div class="flex-1 flex flex-col"> <!-- Top bar --> <header id="admin-header" class="hidden bg-white border-b border-gray-200 px-6 py-3 items-center justify-between"> <button id="mobile-menu-btn" class="lg:hidden text-gray-600 text-sm">
&#9776; Menu
</button> <div class="flex-1"></div> <span id="admin-email" class="text-sm text-gray-500"></span> </header> <!-- Page content --> <main class="flex-1 p-6">  <div class="max-w-6xl mx-auto"> <div class="mb-8"> <h1 class="text-3xl font-bold text-gray-900">Temaer</h1> <p class="text-gray-600 mt-2">V√¶lg UX/design-type uafh√¶ngigt af farver og typografi.</p> </div> <div id="loading" class="text-center py-12 text-gray-500">Henter temaindstillinger...</div> <div id="error" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mb-6"> <p class="text-red-700 mb-2" id="error-text"></p> <button onclick="window.location.reload()" class="text-red-600 underline text-sm">Pr√∏v igen</button> </div> <div id="warning" class="hidden bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6"> <p class="text-amber-800 text-sm" id="warning-text"></p> </div> <div id="content" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-6"> <section class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-6"> <h2 class="text-lg font-semibold text-gray-900 mb-4">Design-type</h2> <p class="text-sm text-gray-600 mb-6">Dette √¶ndrer komponentstruktur, layout-rytme og animationer. Styling (farver, fonts) styres fortsat under ‚ÄúDesign & styling‚Äù.</p> <div id="theme-cards" class="grid gap-4 md:grid-cols-3"></div> <div class="mt-8"> <label class="block text-sm font-medium text-gray-700 mb-2">Bev√¶gelsesprofil</label> <select id="motion_profile" class="w-full max-w-xs border border-gray-300 rounded px-3 py-2"> <option value="standard">Standard</option> <option value="reduced">Reduceret</option> <option value="expressive">Expressive</option> </select> </div> <div class="mt-8 flex gap-3"> <button id="save-btn" class="px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">Gem tema</button> <button id="publish-btn" class="px-5 py-2.5 bg-amber-600 hover:bg-amber-700 text-white rounded-lg font-medium">Publicer til live</button> </div> </section> <aside class="bg-white rounded-xl shadow-sm border border-gray-200 p-6"> <h3 class="font-semibold text-gray-900 mb-3">Aktiv konfiguration</h3> <p class="text-sm text-gray-600">Tema: <span id="active-theme-label" class="font-medium text-gray-900">-</span></p> <p class="text-sm text-gray-600 mt-1">Motion: <span id="active-motion-label" class="font-medium text-gray-900">-</span></p> <div id="success" class="hidden mt-4 text-sm text-green-700 bg-green-50 border border-green-200 rounded p-3">Gemte temaindstillinger.</div> </aside> </div> </div> <script>(function(){const apiUrl = "https://api.lavprishjemmeside.dk";

    (function() {
      const API = apiUrl;
      const token = localStorage.getItem('admin_token');
      if (!token) {
        window.location.href = '/admin/';
        return;
      }

      const THEMES = [
        { key: 'simple', label: 'Simple', description: 'Nuv√¶rende professionelle layout.' },
        { key: 'modern', label: 'Modern', description: 'Markant moderne UX med ny rytme og motion.' },
        { key: 'kreativ', label: 'Kreativ', description: 'Kreativ variant (n√¶ste fase).' },
      ];

      let current = { active_theme_key: 'simple', motion_profile: 'standard' };
      let legacyThemeApi = false;

      function setError(msg) {
        const error = document.getElementById('error');
        const errorText = document.getElementById('error-text');
        if (errorText) errorText.textContent = msg;
        if (error) error.classList.remove('hidden');
      }

      function setWarning(msg) {
        const warning = document.getElementById('warning');
        const warningText = document.getElementById('warning-text');
        if (warningText) warningText.textContent = msg;
        if (warning) warning.classList.remove('hidden');
      }

      function renderCards() {
        const holder = document.getElementById('theme-cards');
        if (!holder) return;
        holder.innerHTML = THEMES.map((t) => `
          <button type="button" data-theme-key="${t.key}" class="theme-card text-left border rounded-lg p-4 transition ${current.active_theme_key === t.key ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'}">
            <div class="font-semibold text-gray-900">${t.label}</div>
            <p class="text-sm text-gray-600 mt-1">${t.description}</p>
          </button>
        `).join('');
        holder.querySelectorAll('[data-theme-key]').forEach((el) => {
          el.addEventListener('click', () => {
            current.active_theme_key = el.getAttribute('data-theme-key');
            renderCards();
            renderActive();
          });
        });
      }

      function renderActive() {
        const theme = THEMES.find((t) => t.key === current.active_theme_key);
        const t = document.getElementById('active-theme-label');
        const m = document.getElementById('active-motion-label');
        if (t) t.textContent = theme ? theme.label : current.active_theme_key;
        if (m) m.textContent = current.motion_profile;
      }

      async function loadThemeSettings() {
        try {
          const endpoint = API + '/theme-settings';
          const res = await fetch(endpoint, {
            headers: { Authorization: 'Bearer ' + token }
          });
          if (res.status === 404) {
            legacyThemeApi = true;
            await loadLegacyThemeSettings();
            return;
          }
          if (!res.ok) {
            let detail = '';
            try {
              const body = await res.json();
              detail = body && body.error ? ` (${body.error})` : '';
            } catch (_) {}
            throw new Error(`Kunne ikke hente temaindstillinger [${res.status}] ${endpoint}${detail}`);
          }
          const data = await res.json();
          current = {
            active_theme_key: data.active_theme_key || 'simple',
            motion_profile: data.motion_profile || 'standard',
          };
          const motion = document.getElementById('motion_profile');
          if (motion) motion.value = current.motion_profile;
          renderCards();
          renderActive();
          document.getElementById('loading')?.classList.add('hidden');
          document.getElementById('content')?.classList.remove('hidden');
        } catch (err) {
          // Failsafe: still allow UI interaction with defaults.
          current = { active_theme_key: 'simple', motion_profile: 'standard' };
          const motion = document.getElementById('motion_profile');
          if (motion) motion.value = current.motion_profile;
          renderCards();
          renderActive();
          document.getElementById('loading')?.classList.add('hidden');
          document.getElementById('content')?.classList.remove('hidden');
          setWarning((err && err.message) ? err.message + '. Viser standardv√¶rdier.' : 'Kunne ikke hente temaindstillinger. Viser standardv√¶rdier.');
        }
      }

      function inferThemeFromPreset(preset) {
        const name = String((preset && preset.name) || '').toLowerCase();
        const label = String((preset && preset.label_da) || '').toLowerCase();
        if (name.includes('modern') || name.includes('minimal') || label.includes('modern') || label.includes('minimal')) return 'modern';
        if (name.includes('kreativ') || name.includes('creative') || label.includes('kreativ') || label.includes('creative')) return 'kreativ';
        return 'simple';
      }

      async function loadLegacyThemeSettings() {
        const settingsRes = await fetch(API + '/design-settings', {
          headers: { Authorization: 'Bearer ' + token }
        });
        if (!settingsRes.ok) throw new Error(`Legacy load failed [${settingsRes.status}] ${API + '/design-settings'}`);
        const settings = await settingsRes.json();

        let inferred = 'simple';
        if (settings && settings.theme_mode === 'modern') {
          inferred = 'modern';
        } else {
          try {
            const presetsRes = await fetch(API + '/theme-presets/', {
              headers: { Authorization: 'Bearer ' + token }
            });
            if (presetsRes.ok) {
              const presets = await presetsRes.json();
              const active = Array.isArray(presets) ? presets.find((p) => Number(p.id) === Number(settings.active_preset_id)) : null;
              if (active) inferred = inferThemeFromPreset(active);
            }
          } catch (_) {}
        }

        current = { active_theme_key: inferred, motion_profile: 'standard' };
        const motion = document.getElementById('motion_profile');
        if (motion) motion.value = 'standard';
        renderCards();
        renderActive();
        document.getElementById('loading')?.classList.add('hidden');
        document.getElementById('content')?.classList.remove('hidden');
        setWarning('K√∏rer i legacy theme mode (theme-settings endpoint mangler).');
      }

      document.getElementById('save-btn')?.addEventListener('click', async () => {
        const motion = document.getElementById('motion_profile');
        if (motion) current.motion_profile = motion.value;
        try {
          if (legacyThemeApi) {
            await saveLegacyThemeSettings();
            return;
          }
          const endpoint = API + '/theme-settings/update';
          const res = await fetch(endpoint, {
            method: 'POST',
            headers: {
              Authorization: 'Bearer ' + token,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(current)
          });
          if (!res.ok) {
            let detail = '';
            try {
              const body = await res.json();
              detail = body && body.error ? ` (${body.error})` : '';
            } catch (_) {}
            throw new Error(`Kunne ikke gemme tema [${res.status}] ${endpoint}${detail}`);
          }
          const data = await res.json();
          current.active_theme_key = data.active_theme_key || current.active_theme_key;
          current.motion_profile = data.motion_profile || current.motion_profile;
          renderCards();
          renderActive();
          const success = document.getElementById('success');
          if (success) {
            success.classList.remove('hidden');
            setTimeout(() => success.classList.add('hidden'), 3000);
          }
        } catch (err) {
          setError(err.message || 'Gemning fejlede');
        }
      });

      async function saveLegacyThemeSettings() {
        const presetsRes = await fetch(API + '/theme-presets/', {
          headers: { Authorization: 'Bearer ' + token }
        });
        if (!presetsRes.ok) throw new Error(`Legacy save failed [${presetsRes.status}] ${API + '/theme-presets/'}`);
        const presets = await presetsRes.json();
        const target = (Array.isArray(presets) ? presets : []).find((p) => inferThemeFromPreset(p) === current.active_theme_key);

        if (target) {
          const applyRes = await fetch(API + '/design-settings/apply-preset', {
            method: 'POST',
            headers: {
              Authorization: 'Bearer ' + token,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ preset_id: target.id })
          });
          if (!applyRes.ok) {
            let detail = '';
            try {
              const body = await applyRes.json();
              detail = body && body.error ? ` (${body.error})` : '';
            } catch (_) {}
            throw new Error(`Kunne ikke gemme tema [${applyRes.status}] ${API + '/design-settings/apply-preset'}${detail}`);
          }
        } else if (current.active_theme_key !== 'kreativ') {
          // Last fallback for very old installs with theme_mode column.
          const updateRes = await fetch(API + '/design-settings/update', {
            method: 'POST',
            headers: {
              Authorization: 'Bearer ' + token,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ theme_mode: current.active_theme_key === 'modern' ? 'modern' : 'simple' })
          });
          if (!updateRes.ok) {
            throw new Error(`Kunne ikke gemme tema [${updateRes.status}] ${API + '/design-settings/update'}`);
          }
        } else {
          throw new Error('Kunne ikke gemme Kreativ i legacy mode: preset mangler.');
        }

        renderCards();
        renderActive();
        const success = document.getElementById('success');
        if (success) {
          success.classList.remove('hidden');
          setTimeout(() => success.classList.add('hidden'), 3000);
        }
      }

      document.getElementById('publish-btn')?.addEventListener('click', async () => {
        try {
          const res = await fetch(API + '/publish', {
            method: 'POST',
            headers: { Authorization: 'Bearer ' + token }
          });
          if (!res.ok) throw new Error('Publicering fejlede');
          const success = document.getElementById('success');
          if (success) {
            success.textContent = 'Tema publiceret. Vent ca. 90 sekunder.';
            success.classList.remove('hidden');
            setTimeout(() => {
              success.classList.add('hidden');
              success.textContent = 'Gemte temaindstillinger.';
            }, 4000);
          }
        } catch (err) {
          setError(err.message || 'Publicering fejlede');
        }
      });

      loadThemeSettings();
    })();
  })();</script>  </main> </div> </div> <!-- Sidebar/header visibility + logout --> <script>
    (function() {
      var path = window.location.pathname.replace(/\/$/, '') || '/admin';
      if (path === '/admin') return;

      // Show sidebar and header on dashboard pages
      var sidebar = document.getElementById('admin-sidebar');
      var header = document.getElementById('admin-header');
      if (sidebar) { sidebar.classList.remove('hidden'); sidebar.classList.add('lg:flex'); }
      if (header) { header.classList.remove('hidden'); header.classList.add('flex'); }

      // Show admin email from JWT; hide Master Hub for non-master
      try {
        var token = localStorage.getItem('admin_token');
        if (token) {
          var payload = JSON.parse(atob(token.split('.')[1]));
          var emailEl = document.getElementById('admin-email');
          if (emailEl) emailEl.textContent = payload.email || '';
          var masterLink = document.getElementById('master-hub-link');
          if (masterLink && payload.role !== 'master') {
            masterLink.style.display = 'none';
          }
        }
      } catch(e) {}

      // Logout
      var logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          localStorage.removeItem('admin_token');
          window.location.href = '/admin/';
        });
      }

      // Mobile menu toggle
      var menuBtn = document.getElementById('mobile-menu-btn');
      if (menuBtn && sidebar) {
        menuBtn.addEventListener('click', function() {
          sidebar.classList.toggle('hidden');
          sidebar.classList.toggle('fixed');
          sidebar.classList.toggle('z-50');
          sidebar.classList.toggle('inset-0');
          sidebar.classList.toggle('flex');
        });
      }

      // Highlight active nav item
      var normalizedPath = path.replace(/\/$/, '') || '/admin';
      var links = sidebar ? sidebar.querySelectorAll('nav a[href]') : [];
      links.forEach(function(a) {
        var href = a.getAttribute('href') || '';
        var linkPath = href.replace(/\/$/, '') || '/admin';
        if (normalizedPath === linkPath) {
          a.classList.add('bg-gray-800', 'text-white');
          a.classList.remove('hover:bg-gray-800');
        }
      });
    })();
    </script>  </body></html>
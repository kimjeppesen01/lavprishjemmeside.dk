---
/**
 * AlternatingFeatureList — Parent component that renders 2–4 immersive
 * long-form blocks as one coherent module. Themes and image placement alternate.
 */
import ImmersiveContentVisual from './ImmersiveContentVisual.astro';

interface Feature {
  headline: string;
  introText?: string;
  content?: string;
  bulletPoints?: string[];
  imageUrl: string;
  imageAlt?: string;
  cta?: { text: string; href: string; icon?: 'chevron-down' | 'arrow-right' };
}

interface Props {
  features: Feature[];
  /** First theme: 'teal' or 'white'. Rest alternate. */
  firstTheme?: 'teal' | 'white';
  overlapAmount?: number;
  instanceId?: string | number;
}

const {
  features = [],
  firstTheme = 'teal',
  overlapAmount = 80,
  instanceId = 'default',
} = Astro.props;

const items = features.slice(0, 4);
---

<div class="alternating-feature-list relative">
  {items.map((feature, index) => {
    const imagePlacement = index % 2 === 0 ? 'right' : 'left';
    const theme = index % 2 === 0 ? firstTheme : firstTheme === 'teal' ? 'white' : 'teal';
    const mappedTheme = theme === 'teal' ? 'accent' : 'default';

    return (
      <div style={index > 0 ? `margin-top: -${Math.round(overlapAmount * 0.3)}px` : undefined}>
      <ImmersiveContentVisual
        headline={feature.headline}
        leadText={feature.introText}
        content={feature.content || '<p></p>'}
        highlights={feature.bulletPoints || []}
        imageUrl={feature.imageUrl}
        imageAlt={feature.imageAlt}
        imagePlacement={imagePlacement}
        overlapDepth={overlapAmount}
        variant="cinematic-overlap"
        theme={mappedTheme}
        cta={feature.cta ? { text: feature.cta.text, href: feature.cta.href } : undefined}
        instanceId={`${instanceId}-${index}`}
      />
      </div>
    );
  })}
</div>

---
/**
 * Tabs â€” Organize dense content (e.g. features, pricing).
 */
interface Props {
  headline: string;
  tabs: Array<{ label: string; content: string }>;
  defaultTab?: number;
  instanceId?: string | number;
}

const {
  headline,
  tabs = [],
  defaultTab = 0,
  instanceId = 'default',
} = Astro.props;

const headingId = `tabs-heading-${instanceId}`;
const tablistId = `tabs-list-${instanceId}`;
---

<section
  class="tabs-section py-[var(--section-padding-y)] px-[var(--container-padding-x)]"
  aria-labelledby={headingId}
>
  <div class="mx-auto max-w-[var(--container-max-width)]">
    <h2
      id={headingId}
      class="tabs-heading text-[var(--font-size-2xl)] font-bold text-[var(--color-text-primary)] md:text-[var(--font-size-3xl)]"
      style="font-family: var(--font-heading)"
    >
      {headline}
    </h2>
    {tabs.length > 0 && (
      <div class="tabs-shell mt-8" data-tabs-instance={instanceId}>
        <div
          role="tablist"
          id={tablistId}
          aria-label="Faner"
          class="tabs-chip-list"
        >
          {tabs.map((tab, i) => (
            <button
              type="button"
              role="tab"
              id={`tab-${instanceId}-${i}`}
              aria-selected={i === defaultTab}
              aria-controls={`panel-${instanceId}-${i}`}
              tabindex={i === defaultTab ? 0 : -1}
              class="tabs-trigger"
              style="font-family: var(--font-body)"
              data-index={i}
              data-active={i === defaultTab ? '' : undefined}
            >
              <span class="tabs-trigger-label">{tab.label}</span>
            </button>
          ))}
        </div>
        <div class="tabs-panel-shell mt-6">
          {tabs.map((tab, i) => (
            <div
              role="tabpanel"
              id={`panel-${instanceId}-${i}`}
              aria-labelledby={`tab-${instanceId}-${i}`}
              hidden={i !== defaultTab}
              class="tabs-panel"
            >
              <div
                class="tabs-panel-prose text-[var(--font-size-base)] leading-[var(--line-height-normal)] text-[var(--color-text-secondary)]"
                style="font-family: var(--font-body)"
                set:html={tab.content}
              />
            </div>
          ))}
        </div>
      </div>
    )}
  </div>
</section>

<script>
  document.querySelectorAll('[data-tabs-instance]').forEach((root) => {
    const triggers = Array.from(root.querySelectorAll('.tabs-trigger'));
    const panels = Array.from(root.querySelectorAll('.tabs-panel'));

    const activate = (index) => {
      triggers.forEach((t, idx) => {
        t.setAttribute('aria-selected', idx === index ? 'true' : 'false');
        t.setAttribute('tabindex', idx === index ? '0' : '-1');
        if (idx === index) t.setAttribute('data-active', '');
        else t.removeAttribute('data-active');
      });
      panels.forEach((p, idx) => {
        p.hidden = idx !== index;
      });
    };

    triggers.forEach((btn, i) => {
      btn.addEventListener('click', () => activate(i));
      btn.addEventListener('keydown', (e) => {
        const key = e.key;
        if (!['ArrowRight', 'ArrowLeft', 'Home', 'End'].includes(key)) return;
        e.preventDefault();
        let next = i;
        if (key === 'ArrowRight') next = (i + 1) % triggers.length;
        if (key === 'ArrowLeft') next = (i - 1 + triggers.length) % triggers.length;
        if (key === 'Home') next = 0;
        if (key === 'End') next = triggers.length - 1;
        activate(next);
        triggers[next].focus();
      });
    });
  });
</script>

<style>
  .tabs-shell {
    border: 1px solid var(--color-border);
    border-radius: clamp(1rem, 2vw, 1.35rem);
    background: var(--color-bg-page);
    padding: clamp(1rem, 2vw, 1.4rem);
    box-shadow: var(--shadow-sm);
  }

  .tabs-chip-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.6rem;
    padding: 0.2rem;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 1rem;
  }

  .tabs-trigger {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 44px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    background: var(--color-bg-page);
    color: var(--color-text-secondary);
    padding: 0.62rem 1rem;
    font-size: var(--font-size-base);
    font-weight: 600;
    line-height: 1.2;
    transition: all 0.22s ease;
    cursor: pointer;
  }

  .tabs-trigger:hover {
    border-color: color-mix(in srgb, var(--color-primary) 40%, var(--color-border));
    color: var(--color-text-primary);
  }

  .tabs-trigger[data-active] {
    border-color: color-mix(in srgb, var(--color-primary) 55%, var(--color-border));
    background: color-mix(in srgb, var(--color-primary) 12%, var(--color-bg-page));
    color: var(--color-primary);
    box-shadow: var(--shadow-sm);
  }

  .tabs-trigger:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px var(--color-bg-page), 0 0 0 4px color-mix(in srgb, var(--color-primary) 45%, transparent);
  }

  .tabs-panel-shell {
    border: 1px solid var(--color-border);
    border-radius: clamp(0.85rem, 1.6vw, 1.1rem);
    background: color-mix(in srgb, var(--color-bg-page) 95%, var(--color-neutral-50));
    padding: clamp(1rem, 2vw, 1.35rem);
  }

  .tabs-panel-prose :global(p:first-child) {
    margin-top: 0;
  }

  .tabs-panel-prose :global(p:last-child) {
    margin-bottom: 0;
  }

  .tabs-panel-prose :global(ul),
  .tabs-panel-prose :global(ol) {
    margin: 0.9rem 0 0;
    padding-left: 1.2rem;
  }

  .tabs-panel-prose :global(li + li) {
    margin-top: 0.4rem;
  }

  html[data-theme='modern'] .tabs-heading {
    letter-spacing: -0.02em;
  }

  html[data-theme='modern'] .tabs-shell {
    border: 1px solid color-mix(in srgb, var(--color-primary) 14%, var(--color-border));
    border-radius: clamp(1.25rem, 2.5vw, 2rem);
    padding: clamp(1rem, 2.5vw, 1.75rem);
    background:
      radial-gradient(220px 160px at 10% 8%, color-mix(in srgb, var(--color-primary-light) 35%, transparent), transparent 75%),
      linear-gradient(155deg, color-mix(in srgb, #fff 92%, var(--color-primary-light) 8%), color-mix(in srgb, #fff 86%, var(--color-secondary-light) 14%));
    box-shadow: 0 14px 34px -22px rgba(16, 34, 70, 0.38);
  }

  html[data-theme='modern'] .tabs-chip-list {
    gap: 0.7rem;
    border-bottom: 0;
    padding: 0.15rem;
    margin-bottom: 0.1rem;
  }

  html[data-theme='modern'] .tabs-trigger {
    border: 1px solid color-mix(in srgb, var(--color-primary) 15%, var(--color-border));
    background: color-mix(in srgb, #fff 88%, var(--color-neutral-50));
    color: color-mix(in srgb, var(--color-text-primary) 75%, var(--color-neutral-700));
    border-radius: 999px;
    padding: 0.66rem 1.12rem;
    box-shadow: 0 2px 8px -6px rgba(14, 26, 56, 0.4);
    transform: translateY(0);
  }

  html[data-theme='modern'] .tabs-trigger:hover {
    transform: translateY(-1px);
    border-color: color-mix(in srgb, var(--color-primary) 28%, var(--color-border));
    background: color-mix(in srgb, #fff 82%, var(--color-primary-light));
  }

  html[data-theme='modern'] .tabs-trigger[data-active] {
    border-color: color-mix(in srgb, var(--color-primary) 55%, var(--color-border));
    background: linear-gradient(145deg, color-mix(in srgb, var(--color-primary-light) 65%, #fff), color-mix(in srgb, var(--color-secondary-light) 45%, #fff));
    color: color-mix(in srgb, var(--color-primary) 82%, #10223d);
    box-shadow: 0 10px 20px -14px color-mix(in srgb, var(--color-primary) 70%, transparent);
  }

  html[data-theme='modern'] .tabs-panel-shell {
    border: 1px solid color-mix(in srgb, var(--color-primary) 18%, var(--color-border));
    border-radius: clamp(1rem, 2vw, 1.45rem);
    background:
      radial-gradient(180px 140px at 95% 10%, color-mix(in srgb, var(--color-secondary-light) 45%, transparent), transparent 72%),
      linear-gradient(150deg, color-mix(in srgb, #fff 95%, var(--color-primary-light) 5%), color-mix(in srgb, #fff 86%, var(--color-secondary-light) 14%));
    padding: clamp(1.15rem, 2.4vw, 1.7rem);
    box-shadow: 0 16px 34px -24px rgba(15, 39, 82, 0.35);
  }

  html[data-theme='modern'] .tabs-panel {
    animation: tabs-modern-rise 320ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  @keyframes tabs-modern-rise {
    from {
      opacity: 0;
      transform: translateY(14px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 767px) {
    .tabs-trigger {
      width: 100%;
      justify-content: flex-start;
    }

    .tabs-chip-list {
      flex-direction: column;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    html[data-theme='modern'] .tabs-panel {
      animation: none;
    }

    html[data-theme='modern'] .tabs-trigger,
    .tabs-trigger {
      transition: none;
    }
  }
</style>

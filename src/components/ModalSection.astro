---
/**
 * Modal / dialog — Forms, CTAs, or media in overlay.
 * Uses native <dialog> for accessibility.
 */
interface Props {
  triggerText: string;
  headline: string;
  content: string;
  instanceId?: string | number;
}

const {
  triggerText = 'Åbn',
  headline,
  content,
  instanceId = 'default',
} = Astro.props;

const dialogId = `modal-dialog-${instanceId}`;
const triggerId = `modal-trigger-${instanceId}`;
---

<section
  class="py-[var(--section-padding-y)] px-[var(--container-padding-x)]"
  aria-label="Modal"
>
  <div class="mx-auto max-w-[var(--container-max-width)]">
    <button
      type="button"
      id={triggerId}
      data-modal-open={dialogId}
      class="focus-modern inline-flex min-h-[44px] min-w-[44px] items-center justify-center gap-2 rounded-[var(--radius-button)] btn-gradient px-6 py-3 text-[var(--font-size-base)] font-semibold text-[var(--color-text-on-primary)] shadow-[var(--shadow-sm)] transition-all"
      style="font-family: var(--font-body)"
    >
      {triggerText}
    </button>

    <dialog
      id={dialogId}
      class="modal-dialog fixed inset-0 z-50 m-0 flex max-h-full max-w-full items-center justify-center border-0 bg-transparent p-4 backdrop:bg-[var(--color-neutral-900,#111)]/80 [&::backdrop]:backdrop-blur-md"
      aria-labelledby={`${dialogId}-title`}
    >
      <div
        class="modal-panel relative max-h-[90vh] w-full max-w-lg overflow-y-auto rounded-[var(--radius-lg)] bg-[var(--color-bg-page)] p-8 shadow-[var(--shadow-xl,0_25px_50px_rgba(0,0,0,0.25))]"
        role="document"
      >
        <div class="flex items-start justify-between gap-4">
          <h2
            id={`${dialogId}-title`}
            class="text-[var(--font-size-xl)] font-bold text-[var(--color-text-primary)]"
            style="font-family: var(--font-heading)"
          >
            {headline}
          </h2>
          <button
            type="button"
            data-modal-close
            class="modal-close-btn shrink-0 rounded-full p-2 text-[var(--color-text-secondary)] transition-all hover:bg-[var(--color-neutral-100,#f5f5f5)] hover:text-[var(--color-text-primary)] hover:rotate-90 focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"
            aria-label="Luk"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div
          class="mt-4 text-[var(--font-size-base)] leading-[var(--line-height-normal)] text-[var(--color-text-secondary)] [&>p]:mt-4 [&>p:first-child]:mt-0"
          style="font-family: var(--font-body)"
          set:html={content}
        />
      </div>
    </dialog>
  </div>
</section>

<style>
/* Entry animation when dialog opens */
.modal-panel {
  animation: modal-enter 300ms var(--motion-ease-enter, cubic-bezier(0, 0, 0.2, 1)) forwards;
}

/* Close button rotate transition */
.modal-close-btn {
  transition: background-color 150ms ease, color 150ms ease, transform 200ms ease;
}
.modal-close-btn:hover {
  transform: rotate(90deg);
}

@media (prefers-reduced-motion: reduce) {
  .modal-panel { animation: none; }
  .modal-close-btn { transition: none; }
  .modal-close-btn:hover { transform: none; }
}
</style>

<script>
  document.addEventListener('click', (e) => {
    const openBtn = (e.target as Element)?.closest('[data-modal-open]');
    if (openBtn) {
      const id = openBtn.getAttribute('data-modal-open');
      const dialog = id ? document.getElementById(id) : null;
      if (dialog && typeof (dialog as HTMLDialogElement).showModal === 'function') {
        (dialog as HTMLDialogElement).showModal();
      }
    }
    const closeBtn = (e.target as Element)?.closest('[data-modal-close]');
    if (closeBtn) {
      const dialog = closeBtn.closest('dialog');
      if (dialog && typeof (dialog as HTMLDialogElement).close === 'function') {
        (dialog as HTMLDialogElement).close();
      }
    }
    if ((e.target as Element)?.tagName === 'DIALOG' && (e.target as HTMLDialogElement).open) {
      (e.target as HTMLDialogElement).close();
    }
  });
</script>

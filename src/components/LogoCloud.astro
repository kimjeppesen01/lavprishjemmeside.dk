---
interface Props {
  headline?: string;
  description?: string;
  logos: Array<{ imageUrl: string; alt: string; link?: string }>;
  grayscale?: boolean;
  animated?: boolean;
  instanceId?: string | number;
}

const {
  headline,
  description,
  logos = [],
  grayscale = true,
  animated = false,
  instanceId = 'default',
} = Astro.props;

// Duplicate logos for seamless marquee loop
const marqueLogos = animated && logos.length > 0 ? [...logos, ...logos] : logos;
---

<section
  class="modern-shell py-[var(--section-padding-y)] px-[var(--container-padding-x)]"
  aria-labelledby={headline ? `logo-heading-${instanceId}` : undefined}
>
  <div class="mx-auto max-w-[var(--container-max-width)]">
    {headline && (
      <>
        <div class="text-center" data-reveal>
          <span class="eyebrow">Samarbejdspartnere</span>
        </div>
        <h2
          id={`logo-heading-${instanceId}`}
          class="heading-fluid mt-3 text-center font-bold text-[var(--color-text-primary)]"
          style="font-family: var(--font-heading); --reveal-delay: 60ms"
          data-reveal
        >
          {headline}
        </h2>
        {description && (
          <p
            class="mx-auto mt-4 max-w-2xl text-center text-[var(--font-size-base)] text-[var(--color-text-secondary)]"
            style="font-family: var(--font-body); --reveal-delay: 120ms"
            data-reveal
          >
            {description}
          </p>
        )}
      </>
    )}

    {animated ? (
      /* Infinite CSS marquee */
      <div class="logo-marquee-wrap mt-10 overflow-hidden" aria-hidden="true">
        <div class="logo-marquee-track">
          {marqueLogos.map((logo) => (
            <div class="logo-marquee-item">
              <img
                src={logo.imageUrl}
                alt={logo.alt}
                class:list={[
                  'h-10 max-w-[120px] object-contain',
                  grayscale ? 'logo-grayscale' : '',
                ]}
                loading="lazy"
              />
            </div>
          ))}
        </div>
      </div>
    ) : (
      /* Static grid */
      <div
        class="mt-10 flex flex-wrap items-center justify-center gap-8 md:gap-12"
        data-reveal
        style="--reveal-delay: 80ms"
      >
        {logos.map((logo) => {
          const img = (
            <img
              src={logo.imageUrl}
              alt={logo.alt}
              class:list={[
                'h-12 max-w-[140px] object-contain transition-all duration-200 hover:opacity-100',
                grayscale ? 'logo-grayscale hover:grayscale-0' : 'opacity-80 hover:opacity-100',
              ]}
              loading="lazy"
            />
          );
          return logo.link ? (
            <a
              href={logo.link}
              target="_blank"
              rel="noopener noreferrer"
              class="focus-modern flex items-center"
              aria-label={logo.alt}
            >
              {img}
            </a>
          ) : (
            img
          );
        })}
      </div>
    )}
  </div>
</section>

<style>
/* Grayscale with contrast reduction + hover reveal */
.logo-grayscale {
  filter: grayscale(100%) contrast(0.75);
  opacity: 0.65;
  transition: filter 200ms ease, opacity 200ms ease;
}
.logo-grayscale:hover,
a:hover .logo-grayscale,
a:focus-visible .logo-grayscale {
  filter: none;
  opacity: 1;
}

/* Marquee track */
.logo-marquee-wrap {
  mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
  -webkit-mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
}
.logo-marquee-track {
  display: flex;
  gap: 3rem;
  width: max-content;
  animation: marquee 28s linear infinite;
}
.logo-marquee-item {
  display: flex;
  align-items: center;
  flex-shrink: 0;
}
.logo-marquee-item img {
  filter: grayscale(100%) contrast(0.75);
  opacity: 0.6;
}
.logo-marquee-wrap:hover .logo-marquee-track {
  animation-play-state: paused;
}

@media (prefers-reduced-motion: reduce) {
  .logo-marquee-track { animation: none; }
}
</style>

---
interface Props {
  headline: string;
  description?: string;
  events: Array<{ year: string; title: string; description: string }>;
  layout?: 'vertical' | 'horizontal';
  instanceId?: string | number;
}

const {
  headline = 'Tidslinje',
  description,
  events = [],
  layout = 'vertical',
  instanceId = 'default',
} = Astro.props;

const isHorizontal = layout === 'horizontal';
---

<section
  class="modern-shell py-[var(--section-padding-y)] px-[var(--container-padding-x)]"
  aria-labelledby={`timeline-heading-${instanceId}`}
>
  <div class="mx-auto max-w-[var(--container-max-width)]">
    <div class="text-center" data-reveal>
      <span class="eyebrow">Historik</span>
    </div>
    <h2
      id={`timeline-heading-${instanceId}`}
      class="heading-fluid mt-3 text-center font-bold text-[var(--color-text-primary)]"
      style="font-family: var(--font-heading); --reveal-delay: 60ms"
      data-reveal
    >
      {headline}
    </h2>
    {description && (
      <p
        class="mx-auto mt-4 max-w-2xl text-center text-[var(--font-size-base)] text-[var(--color-text-secondary)]"
        style="font-family: var(--font-body); --reveal-delay: 120ms"
        data-reveal
      >
        {description}
      </p>
    )}

    {isHorizontal ? (
      /* Horizontal scrolling carousel of dates */
      <div class="mt-12 overflow-x-auto pb-4" role="list">
        <div class="timeline-horizontal-track flex gap-0 min-w-max">
          {events.map((event, index) => (
            <article
              class="timeline-h-item relative flex-1 min-w-[200px] max-w-[260px] px-6"
              role="listitem"
              data-reveal
              style={`--reveal-delay: ${index * 80}ms`}
            >
              {/* Year badge */}
              <div class="timeline-h-dot" aria-hidden="true"></div>
              {/* Connecting line */}
              {index < events.length - 1 && (
                <div class="timeline-h-line" aria-hidden="true"></div>
              )}
              <span
                class="mt-5 block text-[var(--font-size-base)] font-bold text-[var(--color-primary)]"
                style="font-family: var(--font-heading)"
              >
                {event.year}
              </span>
              <h3
                class="mt-1 text-[var(--font-size-base)] font-semibold text-[var(--color-text-primary)]"
                style="font-family: var(--font-heading)"
              >
                {event.title}
              </h3>
              <p
                class="mt-1 text-[var(--font-size-sm)] text-[var(--color-text-secondary)]"
                style="font-family: var(--font-body)"
              >
                {event.description}
              </p>
            </article>
          ))}
        </div>
      </div>
    ) : (
      /* Vertical timeline */
      <div class="mt-12" role="list">
        {events.map((event, index) => {
          const isLatest = index === events.length - 1;
          return (
            <article
              class="relative flex gap-6 pb-10 last:pb-0"
              role="listitem"
              data-reveal
              style={`--reveal-delay: ${index * 80}ms`}
            >
              <div class="relative flex shrink-0 flex-col items-center">
                {/* Gradient dot, pulse on most recent */}
                <div
                  class:list={[
                    'timeline-dot',
                    isLatest && 'timeline-dot--latest',
                  ]}
                  aria-hidden="true"
                ></div>
                {index < events.length - 1 && (
                  <div class="timeline-connector" aria-hidden="true"></div>
                )}
              </div>
              <div class="min-w-0 flex-1 pt-0.5">
                <span
                  class="text-[var(--font-size-base)] font-bold text-[var(--color-primary)]"
                  style="font-family: var(--font-heading)"
                >
                  {event.year}
                </span>
                <h3
                  class="mt-1 text-[var(--font-size-lg)] font-semibold text-[var(--color-text-primary)]"
                  style="font-family: var(--font-heading)"
                >
                  {event.title}
                </h3>
                <p
                  class="mt-2 text-[var(--font-size-base)] text-[var(--color-text-secondary)]"
                  style="font-family: var(--font-body)"
                >
                  {event.description}
                </p>
              </div>
            </article>
          );
        })}
      </div>
    )}
  </div>
</section>

<style>
/* Vertical timeline dot */
.timeline-dot {
  width: 1rem;
  height: 1rem;
  border-radius: 9999px;
  background: var(--gradient-brand, var(--color-primary));
  flex-shrink: 0;
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-primary) 15%, transparent);
}

/* Pulse animation on most recent event */
.timeline-dot--latest {
  animation: timeline-pulse 2s ease-in-out infinite;
}
@keyframes timeline-pulse {
  0%, 100% { box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-primary) 15%, transparent); }
  50% { box-shadow: 0 0 0 6px color-mix(in srgb, var(--color-primary) 8%, transparent); }
}

/* Gradient connecting line */
.timeline-connector {
  position: absolute;
  left: 7px;
  top: 1.25rem;
  width: 2px;
  height: calc(100% - 1rem);
  background: linear-gradient(
    to bottom,
    color-mix(in srgb, var(--color-primary) 40%, transparent),
    color-mix(in srgb, var(--color-border) 60%, transparent)
  );
  border-radius: 1px;
}

/* Horizontal timeline track */
.timeline-h-item { position: relative; }
.timeline-h-dot {
  width: 14px;
  height: 14px;
  border-radius: 9999px;
  background: var(--gradient-brand, var(--color-primary));
  position: absolute;
  top: 0;
  left: 1.5rem;
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-primary) 15%, transparent);
}
.timeline-h-line {
  position: absolute;
  top: 7px;
  left: calc(1.5rem + 14px);
  right: 0;
  height: 2px;
  background: linear-gradient(
    to right,
    color-mix(in srgb, var(--color-primary) 40%, transparent),
    color-mix(in srgb, var(--color-border) 60%, transparent)
  );
}

@media (prefers-reduced-motion: reduce) {
  .timeline-dot--latest { animation: none; }
}
</style>

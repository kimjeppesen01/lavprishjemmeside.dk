---
/**
 * Overlapping Cards Section — Cards displayed in a row with horizontal overlap.
 */
import { buildSrcset } from '../utils/image';

interface Props {
  headline?: string;
  cards: Array<{
    imageUrl?: string;
    imageAlt?: string;
    title: string;
    content: string;
    cta?: { text: string; href: string };
  }>;
  overlapOffset?: number;
  instanceId?: string | number;
}

const {
  headline,
  cards = [],
  overlapOffset = 40,
  instanceId = 'default',
} = Astro.props;

const offset = Math.min(Math.max(overlapOffset || 0, 0), 80);
const headingId = headline ? `overlap-cards-heading-${instanceId}` : undefined;
---

<section
  class="py-[var(--section-padding-y)] px-[var(--container-padding-x)]"
  aria-labelledby={headingId}
>
  <div class="mx-auto max-w-[var(--container-max-width)]">
    {headline && (
      <h2
        id={headingId}
        class="mb-10 text-center text-[var(--font-size-2xl)] font-bold text-[var(--color-text-primary)] md:text-[var(--font-size-3xl)]"
        style="font-family: var(--font-heading)"
      >
        {headline}
      </h2>
    )}
    {cards.length > 0 && (
      <div class="flex flex-col gap-6 md:flex-row md:flex-wrap md:justify-center">
        {cards.slice(0, 3).map((card, i) => (
          <div
            class="relative flex min-w-0 flex-1 flex-col overflow-hidden rounded-[var(--radius-card)] border border-[var(--color-border)] bg-[var(--color-bg-page)] shadow-[var(--shadow-card)] transition-shadow hover:shadow-[var(--shadow-lg)] md:max-w-[340px]"
            style={`
              z-index: ${cards.length - i};
              ${i > 0 && offset > 0 ? `margin-left: -${offset}px;` : ''}
            `}
          >
            {card.imageUrl && (
              <div class="relative h-40 overflow-hidden">
                <img
                  src={card.imageUrl}
                  srcset={buildSrcset(card.imageUrl, [320, 480, 640])}
                  sizes="320px"
                  alt={card.imageAlt || card.title}
                  class="h-full w-full object-cover"
                  loading="lazy"
                />
              </div>
            )}
            <div class="flex flex-1 flex-col p-6">
              <h3
                class="text-[var(--font-size-lg)] font-semibold text-[var(--color-text-primary)]"
                style="font-family: var(--font-heading)"
              >
                {card.title}
              </h3>
              <div
                class="mt-2 flex-1 text-[var(--font-size-base)] leading-[var(--line-height-normal)] text-[var(--color-text-secondary)] [&>p]:mt-2 [&>p:first-child]:mt-0"
                style="font-family: var(--font-body)"
                set:html={card.content}
              />
              {card.cta && (
                <a
                  href={card.cta.href}
                  class="mt-4 inline-flex min-h-[44px] min-w-[44px] items-center text-[var(--font-size-base)] font-medium text-[var(--color-primary)] transition-colors hover:text-[var(--color-primary-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:ring-offset-2"
                  style="font-family: var(--font-body)"
                >
                  {card.cta.text} →
                </a>
              )}
            </div>
          </div>
        ))}
      </div>
    )}
  </div>
</section>

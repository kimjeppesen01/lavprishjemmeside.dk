---
/**
 * Case studies / portfolio — Project showcase with image, title, client, outcome.
 * Link to detail page optional.
 */
import { buildSrcset } from '../utils/image';

interface Props {
  headline: string;
  description?: string;
  cases: Array<{
    image: string;
    title: string;
    client: string;
    outcome: string;
    link?: string;
  }>;
  columns?: 2 | 3;
  instanceId?: string | number;
}

const {
  headline,
  description,
  cases = [],
  columns = 3,
  instanceId = 'default',
} = Astro.props;

const colClass = columns === 2 ? 'md:grid-cols-2' : 'md:grid-cols-2 lg:grid-cols-3';
const headingId = `case-studies-heading-${instanceId}`;
---

<section
  class="py-[var(--section-padding-y)] px-[var(--container-padding-x)]"
  aria-labelledby={headingId}
>
  <div class="mx-auto max-w-[var(--container-max-width)]">
    <h2
      id={headingId}
      class="text-[var(--font-size-2xl)] font-bold text-[var(--color-text-primary)] md:text-[var(--font-size-3xl)]"
      style="font-family: var(--font-heading)"
    >
      {headline}
    </h2>
    {description && (
      <p
        class="mt-2 max-w-2xl text-[var(--font-size-base)] text-[var(--color-text-secondary)]"
        style="font-family: var(--font-body)"
      >
        {description}
      </p>
    )}
    {cases.length > 0 && (
      <div class={`mt-10 grid grid-cols-1 gap-8 ${colClass}`}>
        {cases.map((item) => (
          <article>
            {item.link ? (
              <a
                href={item.link}
                class="block transition-opacity hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:ring-offset-2 rounded-[var(--radius-lg)]"
              >
                <div class="overflow-hidden rounded-[var(--radius-lg)] shadow-[var(--shadow-card)]">
                  <img
                    src={item.image}
                    srcset={buildSrcset(item.image, [400, 600, 800])}
                    sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"
                    alt={`${item.title} – ${item.client}`}
                    class="h-48 w-full object-cover transition-transform hover:scale-[1.02]"
                    loading="lazy"
                  />
                </div>
                <div class="mt-4">
                  <h3
                    class="text-[var(--font-size-lg)] font-semibold text-[var(--color-text-primary)]"
                    style="font-family: var(--font-heading)"
                  >
                    {item.title}
                  </h3>
                  <p
                    class="mt-1 text-[var(--font-size-sm)] text-[var(--color-primary)]"
                    style="font-family: var(--font-body)"
                  >
                    {item.client}
                  </p>
                  <p
                    class="mt-2 text-[var(--font-size-base)] text-[var(--color-text-secondary)]"
                    style="font-family: var(--font-body)"
                  >
                    {item.outcome}
                  </p>
                </div>
              </a>
            ) : (
              <>
                <div class="overflow-hidden rounded-[var(--radius-lg)] shadow-[var(--shadow-card)]">
                  <img
                    src={item.image}
                    srcset={buildSrcset(item.image, [400, 600, 800])}
                    sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"
                    alt={`${item.title} – ${item.client}`}
                    class="h-48 w-full object-cover transition-transform hover:scale-[1.02]"
                    loading="lazy"
                  />
                </div>
                <div class="mt-4">
                  <h3
                    class="text-[var(--font-size-lg)] font-semibold text-[var(--color-text-primary)]"
                    style="font-family: var(--font-heading)"
                  >
                    {item.title}
                  </h3>
                  <p
                    class="mt-1 text-[var(--font-size-sm)] text-[var(--color-primary)]"
                    style="font-family: var(--font-body)"
                  >
                    {item.client}
                  </p>
                  <p
                    class="mt-2 text-[var(--font-size-base)] text-[var(--color-text-secondary)]"
                    style="font-family: var(--font-body)"
                  >
                    {item.outcome}
                  </p>
                </div>
              </>
            )}
          </article>
        ))}
      </div>
    )}
  </div>
</section>

---
/**
 * Case studies / portfolio — Project showcase with image, title, client, outcome.
 * Link to detail page optional.
 */
import { buildSrcset } from '../utils/image';

interface Props {
  headline: string;
  description?: string;
  cases: Array<{
    image: string;
    title: string;
    client: string;
    outcome: string;
    link?: string;
    tag?: string;
  }>;
  columns?: 2 | 3;
  instanceId?: string | number;
}

const {
  headline,
  description,
  cases = [],
  columns = 3,
  instanceId = 'default',
} = Astro.props;

const colClass = columns === 2 ? 'md:grid-cols-2' : 'md:grid-cols-2 lg:grid-cols-3';
const headingId = `case-studies-heading-${instanceId}`;
---

<section
  class="modern-shell py-[var(--section-padding-y)] px-[var(--container-padding-x)]"
  aria-labelledby={headingId}
>
  <div class="mx-auto max-w-[var(--container-max-width)]">
    <div class="text-center" data-reveal>
      <span class="eyebrow">Portefølje</span>
    </div>
    <h2
      id={headingId}
      class="heading-fluid mt-3 text-center font-bold text-[var(--color-text-primary)]"
      style="font-family: var(--font-heading); --reveal-delay: 60ms"
      data-reveal
    >
      {headline}
    </h2>
    {description && (
      <p
        class="mx-auto mt-4 max-w-2xl text-center text-[var(--font-size-base)] text-[var(--color-text-secondary)]"
        style="font-family: var(--font-body); --reveal-delay: 120ms"
        data-reveal
      >
        {description}
      </p>
    )}
    {cases.length > 0 && (
      <div class={`mt-10 grid grid-cols-1 gap-8 ${colClass}`}>
        {cases.map((item, i) => (
          <article
            class="case-card group card-modern overflow-hidden p-0"
            data-reveal
            style={`--reveal-delay: ${i * 80}ms`}
          >
            {/* Image with overlay reveal */}
            <div class="case-img-wrap relative overflow-hidden">
              <img
                src={item.image}
                srcset={buildSrcset(item.image, [400, 600, 800])}
                sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"
                alt={`${item.title} – ${item.client}`}
                class="h-56 w-full object-cover transition-transform duration-500 group-hover:scale-[1.04]"
                loading="lazy"
              />

              {/* Tag badge overlay on image */}
              {item.tag && (
                <span
                  class="case-tag absolute top-3 left-3 rounded-full px-3 py-1 text-xs font-semibold text-white"
                  style="background: var(--gradient-brand, var(--color-primary))"
                >
                  {item.tag}
                </span>
              )}

              {/* Hover overlay with outcome */}
              <div class="case-overlay absolute inset-0 flex flex-col justify-end p-5">
                <p class="text-sm font-medium text-white leading-[1.5]">{item.outcome}</p>
                {item.link && (
                  <span class="mt-2 inline-flex items-center gap-1.5 text-sm font-semibold text-white">
                    Se projekt
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                  </span>
                )}
              </div>
            </div>

            {/* Card body */}
            <div class="p-5">
              <h3
                class="text-[var(--font-size-lg)] font-semibold text-[var(--color-text-primary)] group-hover:text-[var(--color-primary)] transition-colors"
                style="font-family: var(--font-heading)"
              >
                {item.link ? (
                  <a href={item.link} class="focus-modern after:absolute after:inset-0">
                    {item.title}
                  </a>
                ) : item.title}
              </h3>
              <p
                class="mt-1 text-[var(--font-size-sm)] font-medium text-[var(--color-primary)]"
                style="font-family: var(--font-body)"
              >
                {item.client}
              </p>
              <p
                class="mt-2 text-[var(--font-size-base)] text-[var(--color-text-secondary)] line-clamp-2"
                style="font-family: var(--font-body)"
              >
                {item.outcome}
              </p>
            </div>
          </article>
        ))}
      </div>
    )}
  </div>
</section>

<style>
/* Card: no padding on root, overflow-hidden for image */
.case-card { position: relative; }

/* Image hover scale */
.case-img-wrap { aspect-ratio: 16 / 10; }

/* Overlay: hidden by default, slides up on hover */
.case-overlay {
  background: linear-gradient(
    to top,
    color-mix(in srgb, var(--color-text-primary) 80%, transparent) 0%,
    transparent 70%
  );
  opacity: 0;
  transform: translateY(4px);
  transition:
    opacity 280ms var(--motion-ease-standard, ease),
    transform 280ms var(--motion-ease-standard, ease);
}
.case-card:hover .case-overlay,
.case-card:focus-within .case-overlay {
  opacity: 1;
  transform: translateY(0);
}

@media (prefers-reduced-motion: reduce) {
  .case-img-wrap img { transition: none; }
  .case-overlay { transition: none; }
}
</style>

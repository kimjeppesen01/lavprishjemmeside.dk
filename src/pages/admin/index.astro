---
import AdminLayout from '../../layouts/AdminLayout.astro';
---

<AdminLayout title="Log ind">
  <div class="min-h-screen flex items-center justify-center -m-6">
    <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-sm">
      <h1 class="text-2xl font-bold text-center mb-6">Admin Login</h1>
      <div id="error-msg" class="hidden bg-red-50 text-red-700 text-sm px-4 py-2 rounded-lg mb-4"></div>
      <form id="login-form" class="space-y-4">
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
          <input type="email" id="email" name="email" required autocomplete="email"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" />
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Adgangskode</label>
          <input type="password" id="password" name="password" required autocomplete="current-password"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" />
          <div class="mt-1 text-right">
            <a href="/admin/forgot-password" class="text-xs text-blue-600 hover:underline">
              Glemt adgangskode?
            </a>
          </div>
        </div>
        <button type="submit" id="submit-btn"
          class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium">
          Log ind
        </button>
      </form>
    </div>
  </div>

  <script is:inline>
  (function() {
    var API = import.meta.env.PUBLIC_API_URL || 'https://api.lavprishjemmeside.dk';
    var form = document.getElementById('login-form');
    var errorMsg = document.getElementById('error-msg');
    var submitBtn = document.getElementById('submit-btn');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      errorMsg.classList.add('hidden');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Logger ind...';

      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;

      fetch(API + '/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email, password: password })
      })
      .then(function(res) { return res.json().then(function(data) { return { ok: res.ok, data: data }; }); })
      .then(function(result) {
        if (!result.ok) {
          throw new Error(result.data.error || 'Login mislykkedes');
        }
        localStorage.setItem('admin_token', result.data.token);
        window.location.href = '/admin/dashboard/';
      })
      .catch(function(err) {
        errorMsg.textContent = err.message;
        errorMsg.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Log ind';
      });
    });
  })();
  </script>
</AdminLayout>

---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Glemt adgangskode">
  <div class="min-h-screen flex items-center justify-center -m-6">
    <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-sm">
      <h1 class="text-2xl font-bold text-center mb-2">Glemt adgangskode?</h1>
      <p class="text-sm text-gray-600 text-center mb-6">
        Indtast din e-mail, og vi sender dig et link til at nulstille din adgangskode.
      </p>

      <!-- Success message -->
      <div id="success-msg" class="hidden bg-green-50 text-green-700 text-sm px-4 py-3 rounded-lg mb-4">
        <p id="success-text"></p>
      </div>

      <!-- Error message -->
      <div id="error-msg" class="hidden bg-red-50 text-red-700 text-sm px-4 py-2 rounded-lg mb-4"></div>

      <form id="forgot-form" class="space-y-4">
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            autocomplete="email"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
          />
        </div>
        <button
          type="submit"
          id="submit-btn"
          class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium"
        >
          Send nulstillingslink
        </button>
      </form>

      <div class="mt-4 text-center">
        <a href="/admin/" class="text-sm text-blue-600 hover:underline">
          Tilbage til login
        </a>
      </div>
    </div>
  </div>

  <script is:inline>
  (function() {
    var API = 'https://api.lavprishjemmeside.dk';
    var form = document.getElementById('forgot-form');
    var errorMsg = document.getElementById('error-msg');
    var successMsg = document.getElementById('success-msg');
    var successText = document.getElementById('success-text');
    var submitBtn = document.getElementById('submit-btn');
    var emailInput = document.getElementById('email');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      errorMsg.classList.add('hidden');
      successMsg.classList.add('hidden');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sender...';

      var email = emailInput.value;

      fetch(API + '/auth/forgot-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email })
      })
      .then(function(res) {
        return res.json().then(function(data) {
          return { ok: res.ok, data: data };
        });
      })
      .then(function(result) {
        if (!result.ok) {
          throw new Error(result.data.error || 'Anmodning mislykkedes');
        }

        // Show success message
        successText.textContent = result.data.message || 'Hvis e-mailen findes i systemet, er der sendt en nulstillingsmail.';
        successMsg.classList.remove('hidden');

        // Disable form
        emailInput.disabled = true;
        submitBtn.disabled = true;
        submitBtn.textContent = 'E-mail sendt';
      })
      .catch(function(err) {
        errorMsg.textContent = err.message;
        errorMsg.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send nulstillingslink';
      });
    });
  })();
  </script>
</Layout>
